[build.env]
passthrough = [
    "RUST_BACKTRACE",
    "BORING_BSSL_PATH",
    "BORING_BSSL_INCLUDE_PATH",
]

# i686-unknown-linux-musl needs special setup for boring-sys (BoringSSL)
# The default cross image doesn't have 32-bit toolchain for building BoringSSL
# Multi-stage build pre-compiles BoringSSL with correct musl cross-compiler
[target.i686-unknown-linux-musl]
dockerfile = "Dockerfile.i686-musl-boring"

[target.i686-unknown-linux-musl.env]
passthrough = [
    "RUST_BACKTRACE",
    "CARGO_TARGET_I686_UNKNOWN_LINUX_MUSL_RUSTFLAGS",
]
volumes = []

# Set BoringSSL paths directly in the build environment
BORING_BSSL_PATH = "/opt/boringssl"
BORING_BSSL_INCLUDE_PATH = "/opt/boringssl/include"
BORING_BSSL_PATH_i686_unknown_linux_musl = "/opt/boringssl"
BORING_BSSL_INCLUDE_PATH_i686_unknown_linux_musl = "/opt/boringssl/include"

# x86_64 and aarch64: multi-stage build to pre-compile BoringSSL
[target.x86_64-unknown-linux-musl]
dockerfile = "Dockerfile.x86_64-musl-boring"

[target.x86_64-unknown-linux-musl.env]
passthrough = [
    "RUST_BACKTRACE",
    "CARGO_TARGET_X86_64_UNKNOWN_LINUX_MUSL_RUSTFLAGS",
]
volumes = []

# Set BoringSSL paths directly in the build environment
BORING_BSSL_PATH = "/opt/boringssl"
BORING_BSSL_INCLUDE_PATH = "/opt/boringssl/include"
BORING_BSSL_PATH_x86_64_unknown_linux_musl = "/opt/boringssl"
BORING_BSSL_INCLUDE_PATH_x86_64_unknown_linux_musl = "/opt/boringssl/include"

[target.aarch64-unknown-linux-musl]
dockerfile = "Dockerfile.aarch64-musl-boring"

[target.aarch64-unknown-linux-musl.env]
passthrough = [
    "RUST_BACKTRACE",
    "CARGO_TARGET_AARCH64_UNKNOWN_LINUX_MUSL_RUSTFLAGS",
]
volumes = []

# Set BoringSSL paths directly in the build environment
BORING_BSSL_PATH = "/opt/boringssl"
BORING_BSSL_INCLUDE_PATH = "/opt/boringssl/include"
BORING_BSSL_PATH_aarch64_unknown_linux_musl = "/opt/boringssl"
BORING_BSSL_INCLUDE_PATH_aarch64_unknown_linux_musl = "/opt/boringssl/include"
